<!--

Updates the ValueSets. Has functions for direct editing and importing from spreadsheets
 Intended for internal use only
-->


<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/">
    <meta charset="UTF-8">
    <title>ValueSet editor</title>

    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-2.0.1.min.js"></script>
    <script src="js/libs/moment.min.js"></script>

    <script src="js/libs/ngStorage.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/common.css"/>
    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>

    <!--
    <style>
        .retired {
            background-color: lightsalmon;
        }
    </style>
    -->

    <script>
        angular.module("pocApp",['ui.bootstrap','ui.checkbox',"firebase",'ngStorage']).config(function($locationProvider) {
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');
        });
        angular.module("pocApp").constant("moment", moment);

        angular.module("pocApp").config(['$compileProvider', function ($compileProvider) {
            $compileProvider.aHrefSanitizationWhitelist(/^\s*(http|https?|ftp|mailto|blob):/);
        }]);

        angular.module("formsApp",[])
        angular.module('topApp', ['pocApp', 'formsApp'])

    </script>



    <script src="js/libs/angular-bootstrap-checkbox.js"></script>
    <script src="js/updateVSCtrl.js"></script>
    <script src="js/querySvc.js"></script>
    <script src="js/updateVSSvc.js"></script>
    <script src="js/showParameters.js"></script>
    <script src="js/loginCtrl.js"></script>
    <script src="js/utilsSvc.js"></script>
    <script src="js/viewVSCtrl.js"></script>

    <script src="js/terminologyUpdateSvc.js"></script>


    <script src="js/filters.js"></script>
    <script src="js/customCodeSystemCtrl.js"></script>
    <script src="js/enterConceptsCtrl.js"></script>


    <script src="js/libs/firebase.js"></script>
    <script src="js/libs/angularfire.min.js"></script>
    <script src="js/cmTesterSvc.js"></script>

    <!--
        <script src="js/uploadCM.js"></script>
        <script src="js/cmViewerCtrl.js"></script>

    -->

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDG1ToLHycsMUX0CfX0OZVSRUUpFQeKE9o",
            authDomain: "canshare-730e6.firebaseapp.com",
            projectId: "canshare-730e6",
            storageBucket: "canshare-730e6.appspot.com",
            messagingSenderId: "12147821347",
            appId: "1:12147821347:web:5963d577cb050259475a96"
        };
        if (firebase) {
            console.log('init firebase')
            firebase.initializeApp(firebaseConfig);

        }
    </script>

</head>
<body style="padding: 8px;padding-top: 80px">
<div ng-app="topApp" ng-controller="updateVSCtrl" class="container-fluid">

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">

        <div class="container-fluid">
            <div class="col-md-4">
                    <span>
                        <a class="navbar-brand" href="#">
                            ValueSet editor
                        </a>
                    </span>

            </div>

            <div class="col-md-3">
                <div class="navbar-text">
                    Number of ValueSets:
                    <span class="badge">{{allVSItem.length}}</span>
                </div>

            </div>

            <div class="col-md-1">
                <div class="navbar-text" >
                    <div class="pull-right btn">{{version}}</div>
                </div>
            </div>

            <div class="col-md-1 col-sm-1">
                <form class="navbar-form navbar-left">
                    <img ng-show="showWaiting" src="css/ajax_loader_blue_32.gif"/>

                </form>
            </div>

            <div class="col-md-1 col-sm-1">
                <div class="navbar-text " ng-hide="user">
                    <span style="font-size:1.2em; cursor: pointer" uib-popover="Click to log in"
                          popover-placement="left"
                          popover-trigger="'mouseenter'">
                        <div ng-click="login()">
                            <i class="glyphicon glyphicon-log-in"></i>
                        </div>
                    </span>
                </div>

                <div class="navbar-text"  ng-show="user">
                    <span style="font-size:1.2em;  cursor: pointer" uib-popover="{{user.email}}"
                          popover-placement="left"
                          popover-trigger="'mouseenter'">
                        <div ng-click="logout()">
                            <i class="glyphicon glyphicon-log-out"></i>
                        </div>
                    </span>
                </div>

            </div>



            <div class="col-md-2">
                <a href="https://teaho.govt.nz/" target="_blank">
                    <img width="150" height="auto" class="pull-right"
                         style="padding: 3px"
                         src="images/TAK-logo-midgreen.png"/>
                </a>
            </div>
        </div>
    </nav>

    <button ng-hide = "showWaitingTimeout" style="margin-right: 8px"
            ng-click="setSyndicationStatus()"
            class="btn-danger btn pull-right">Set Syndication status</button>

    <button ng-if = "user.email" class="pull-right btn-link btn" ng-click="updateTest()">Update Test</button>

    <button class="btn btn-info pull-right" ng-show = "showWaitingTimeout" style="margin-right: 8px">
        Syndicating. Progress: {{syndProgress}}
    </button>




    <uib-tabset active="input.topTabActive">



        <uib-tab heading="Edit ValueSet">
            <br/>

            <div class="row">
                <div class="col-md-4">

                    <uib-tabset>
                        <uib-tab heading="Alphabetical">
                            <br/>
                            <div class="row">

                                <div class="col-md-6">
                                    <checkbox ng-model="input.includeRetired"></checkbox> Include retired & draft
                                </div>

                                <div class="col-md-6">
                                    <button class="btn-link btn pull-right" ng-click="createNew()">New</button>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <input placeholder="Filter" type="text" class="form-control" ng-model="input.filterlist"/>
                                    <br/>
                                    <div class="myScroll">
                                        <div class="list-group">
                                            <div ng-class="{'list-group-item':true,listItemSelected:selectedItem.vs.id==item.vs.id,retiredVS:item.vs.status == 'retired',draftVS:item.vs.status == 'draft'}"
                                                 ng-show="showVS(item)"
                                                 style="cursor: pointer" ng-repeat="item in allVSItem" ng-click="selectVSItem(item)">
                                                {{item.display}}

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </uib-tab>

                        <uib-tab  heading="Last updated">
                            <div class="myScroll">
                                <div class="list-group">
                                    <div ng-class="{'list-group-item':true,listItemSelected:selectedItem.vs.id==item.vs.id,retiredVS:item.vs.status == 'retired',draftVS:item.vs.status == 'draft'}"
                                         style="cursor: pointer" ng-repeat="item in sortedVS" ng-click="selectVSItem(item)">
                                        <div>{{item.display}}</div>
                                        <div class="pull-right"><em>{{item.vs.meta.lastUpdated | ageSeconds}}</em></div>
                                        <div class="clearfix"></div>
                                    </div>
                                </div>
                            </div>

                        </uib-tab>
                        <uib-tab  heading="Bespoke query">
                            <textarea class="form-control" ng-model="input.bespoke"
                                      placeholder="Enter query - eg ValueSet?name=cs"></textarea>

                            <button class="btn-link btn" ng-click="executeBespoke(input.bespoke)">Execute</button>
                        </uib-tab>
                    </uib-tabset>



                </div>

                <div ng-show="selectedVS" class="col-md-8">

                    <div class="alert-info alert" ng-hide="user">
                        Update and Create operations on the publishing Server can only be done by
                        logged in users
                    </div>

                    <div class="banner">
                        {{selectedVS.title}}
                    </div>

                    <div ng-show="isMaximalVS" class="banner">
                        >>> This is a Maximal ValueSet for referencing a CodeSystem. It is not editable. <<<
                    </div>




                    <div>

                        <button ng-show = "user && user.email && canSave() && ! isMaximalVS" class="btn btn-danger pull-right">
                            <span ng-show="isNew" ng-click="newVS()">Save new VS</span>
                            <span ng-hide="isNew" ng-click="updateVS(selectedVS)">Update VS</span>
                        </button>


                    </div>



                    <uib-tabset active="input.mainTabActive">



                        <uib-tab heading="Edit ValueSet">
                            <table class="table">
                                <tr>
                                    <td>Id</td>
                                    <td>
                                        <div class="row">
                                            <div class="col-md-9">
                                                <input type="text"
                                                       ng-disabled="! isNew"
                                                       ng-blur = checkNewVS(input.id)
                                                       class="form-control" ng-model="input.id"/>
                                            </div>
                                            <div class="col-md-3">
                                                <button
                                                        ng-click="showLink(input.id)"
                                                        class="pull-right btn btn-link">Link to ValueSet</button>
                                            </div>
                                        </div>
                                    </td>

                                </tr>
                                <tr>
                                    <td>Url</td>
                                    <td>
                                        <input type="text" class="form-control" disabled="disabled" ng-model="selectedVS.url"/>

                                    </td>

                                </tr>

                                <tr>
                                    <td>VS Status</td>
                                    <td>
                                        <select ng-disabled="isMaximalVS" ng-model="input.status" class="form-control" ng-change = makeVS()>
                                            <option value="active">Active</option>
                                            <option value="retired">Retired</option>
                                            <option value="draft">Draft</option>
                                        </select>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Syndication Status</td>
                                    <td>
                                        {{syndicationStatus}}
                                    </td>
                                </tr>

                                <tr>
                                    <td>Last updated</td>
                                    <td>
                                        {{selectedVS.meta.lastUpdated | date}}
                                    </td>
                                </tr>

                                <tr ng-show="false">
                                    <td>Member count</td>
                                    <td>
                                        <span class="badge">{{getMemberCount(selectedVS)}}</span>

                                        <div ng-show="false" class="btn-link btn pull-right" ng-click="updateMemberCount(selectedVS)">Refresh member count</div>

                                    </td>
                                </tr>


                                <tr>
                                    <td>Title</td>
                                    <td>
                                        <input  ng-disabled="isMaximalVS" type="text" class="form-control" ng-change = makeVS() ng-model="input.title"/>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Description</td>
                                    <td>
                                        <textarea  ng-disabled="isMaximalVS" class="form-control" ng-change = makeVS() ng-model="input.description"></textarea>
                                    </td>
                                </tr>

                                <tr ng-if=" ! isMaximalVS">
                                    <td>ECL

                                        <div ng-show = "testEclVS.expansion.contains.length > 0">
                                            <br/>
                                            <em>{{testEclVS.expansion.contains.length}} concepts </em>
                                        </div>

                                    </td>
                                    <td>
                                        <div class="row">
                                            <div class="col-md-10">
                                                <textarea class="form-control" ng-change = makeVS() ng-model="input.ecl"></textarea>

                                            </div>
                                            <div class="col-md-2">
                                                <button
                                                        ng-show="input.ecl"
                                                        class="btn btn-link" ng-click="listConcepts(input.ecl)">Test ECL</button>
                                            </div>
                                        </div>

                                    </td>
                                </tr>



                                <tr ng-if=" !isMaximalVS">
                                    <td  width = "20%">Display concepts
                                        <div><br/><em>Published concepts where the description is incorrect</em></div>
                                    </td>
                                    <td>

                                        <table class="table table-bordered">
                                            <tr><th>Code</th><th>Display</th><th>

                                                <i  class="glyphicon glyphicon-plus-sign clickable pull-right"
                                                    uib-popover="Add multiple concepts"
                                                    popover-placement="left"
                                                    popover-trigger="'mouseenter'"
                                                    ng-click="selectOtherConcepts(input.displayConcepts,'http://snomed.info/sct')"></i>

                                            </th></tr>
                                            <tr ng-repeat="concept in input.displayConcepts">
                                                <td width="20%">

                                                    <div  class="clickable" ng-click="lookup(concept.code,concept.system)">{{concept.code}}</div>




                                                </td>
                                                <td>{{concept.display}}</td>
                                                <td width="10%"><i style="color: red" class="glyphicon glyphicon-remove clickable"
                                                       ng-click="removeDisplayConcept($index)"></i></td>
                                            </tr>
                                            <tr>
                                                <td width="20%">
                                                    <div class="row">
                                                        <div class="col-md-10">
                                                            <input ng-model="input.newDisplayCode" type="text" class="form-control"/>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <i style="color: orange" class="glyphicon glyphicon-question-sign clickable"
                                                               ng-show="input.newDisplayCode"
                                                               ng-click="getDisplay(input.newDisplayCode,'newDisplayDisplay')"></i>
                                                        </div>
                                                    </div>

                                                </td>
                                                <td><input ng-model="input.newDisplayDisplay" type="text" class="form-control"/> </td>
                                                <td>


                                                    <i style="color: green" class="glyphicon glyphicon-ok clickable"
                                                       ng-show="input.newDisplayCode && input.newDisplayDisplay"
                                                       ng-click="addDisplayConcept()"></i>

                                                </td>
                                            </tr>

                                        </table>
                                    </td>
                                </tr>



                                <tr ng-if=" !isMaximalVS">
                                    <td>Unpublished concepts
                                        <div><em><br/>Concepts created but not yet published. They are in a separate CodeSystem</em></div>

                                        <div ng-show = "input.prePubConcepts.length > 0">
                                            <br/>
                                            <em>{{input.prePubConcepts.length}} concepts</em>
                                        </div>

                                    </td>
                                    <td>

                                        <table class="table table-bordered">
                                            <tr><th>Code</th><th>Display</th><th>
                                                <i  class="glyphicon glyphicon-plus-sign clickable pull-right"
                                                    uib-popover="Add multiple concepts"
                                                    popover-placement="left"
                                                    popover-trigger="'mouseenter'"
                                                    ng-click="selectOtherConcepts(input.prePubConcepts,'http://canshare.co.nz/fhir/CodeSystem/snomed-unpublished')"></i>

                                            </th></tr>
                                            <tr ng-repeat="concept in input.prePubConcepts">
                                                <td width="20%">
                                                    <div  class="clickable" ng-click="lookup(concept.code,'http://canshare.co.nz/fhir/CodeSystem/snomed-unpublished')">{{concept.code}}</div>

                                                </td>
                                                <td>{{concept.display}}</td>
                                                <td width="10%"><i style="color: red" class="glyphicon glyphicon-remove clickable"
                                                       ng-click="removePPConcept($index)"></i></td>
                                            </tr>
                                            <tr>
                                                <td width="20%">
                                                    <div class="row">
                                                        <div class="col-md-10">
                                                            <input ng-model="input.newPPCode" type="text" class="form-control"/>
                                                        </div>
                                                        <!--
                                                        <div class="col-md-2">
                                                            <i style="color: orange" class="glyphicon glyphicon-question-sign clickable"
                                                               ng-show="input.newPPCode"
                                                               ng-click="getDisplay(input.newPPCode,'newPPDisplay')"></i>
                                                        </div>
                                                        -->
                                                    </div>




                                                </td>
                                                <td><input ng-model="input.newPPDisplay" type="text" class="form-control"/> </td>
                                                <td>


                                                    <i style="color: green" class="glyphicon glyphicon-ok clickable"
                                                       ng-show="input.newPPCode && input.newPPDisplay"
                                                       ng-click="addPPConcept()"></i>

                                                </td>
                                            </tr>

                                        </table>
                                    </td>
                                </tr>

                                <tr  ng-if=" !isMaximalVS">
                                    <td>Other CodeSystems
                                        <div><em><br/>Concepts from some other CodeSystem</em></div>

                                        <div ng-show = "input.otherCS.length > 0">
                                            <br/>
                                            <em>{{input.otherCS.length}} concepts</em>
                                        </div>



                                    </td>
                                    <td>
<!--
                                        <div class="row">
                                            <div class="col-md-9">
                                                <input ng-model="input.newOtherCsSystem" type="text"
                                                       placeholder="Enter the fullUrl of the CodeSystem to import"
                                                       class="form-control"/>
                                            </div>
                                            <div class="col-md-3">
                                                <div class='clickable' ng-show="input.newOtherCsSystem"
                                                     ng-click="selectOtherConcepts(input.newOtherCsSystem)">Validate</div>

                                            </div>
                                        </div>
                                        -->

                                        <br/>

                                        <table class="table table-bordered">
                                            <tr><th>Code</th><th>Display</th><th>System</th><th>

                                                <i  class="glyphicon glyphicon-plus-sign clickable pull-right"
                                                   uib-popover="Add multiple concepts"
                                                   popover-placement="left"
                                                   popover-trigger="'mouseenter'"
                                                   ng-click="selectOtherConcepts(input.otherCsConcepts)"></i>




                                            </th></tr>
                                            <tr ng-repeat="concept in input.otherCsConcepts">
                                                <td>
                                                    {{concept.code}}
                                                </td>
                                                <td>{{concept.display}}</td>
                                                <td>{{concept.system}}</td>
                                                <td><i style="color: red" class="glyphicon glyphicon-remove clickable"
                                                       ng-click="removeOtherCsConcept($index)"></i></td>
                                            </tr>

                                            <tr>
                                                <td  width="20%">
                                                    <div class="row">
                                                        <div class="col-md-10">
                                                            <input ng-model="input.newOtherCsCode" type="text" class="form-control"/>
                                                        </div>

                                                    </div>

                                                </td>
                                                <td><input ng-model="input.newOtherCsDisplay" type="text" class="form-control"/> </td>
                                                <td>
                                                    <input ng-model="input.newOtherCsSystem" type="text"
                                                           class="form-control"/>
                                                </td>

                                                <td width="10%">

                                                    <i style="color: green" class="glyphicon glyphicon-ok clickable"
                                                       ng-show="input.newOtherCsCode && input.newOtherCsDisplay && input.newOtherCsSystem"
                                                       ng-click="addOtherCsConcept()"></i>

                                                </td>
                                            </tr>


                                        </table>
                                    </td>
                                </tr>


                                <tr ng-if="csInVs.length > 0">
                                    <td>CodeSystem/s in VS</td>
                                    <td>
                                        <div ng-repeat="system in csInVs">
                                            {{system}}
                                        </div>
                                    </td>
                                </tr>


                            </table>

                            <!--
                            <div ng-show="testEclVS">
                                <strong>ECL result</strong> {{testEclVS.expansion.contains.length}} concepts
                                <table class="table table-bordered table-condensed">
                                    <tr><th>Display</th><th>Code</th><th>System</th></tr>
                                    <tr ng-repeat="concept in testEclVS.expansion.contains">
                                        <td>{{concept.display}}</td>
                                        <td>
                                            <div  class="clickable" ng-click="lookup(concept.code)">{{concept.code}}</div></td>
                                        <td>{{concept.system}}</td>
                                    </tr>
                                </table>

                            </div>
                            -->


                        </uib-tab>

                        <uib-tab heading="Expand">
                            <br/>
                            <div class="row">

                                <div class="col-md-3">
                                    <input type="text" class="form-control" ng-model="input.filter" placeholder="Filter text"/>
                                </div>
                                <div class="col-md-3">
                                    <div ng-show="expandedVS.expansion.contains">{{expandedVS.expansion.contains.length}} concepts</div>
                                </div>

                                <div class="col-md-6">
                                    <button class="btn btn-primary pull-right" ng-click="expandVSInTS(selectedVS)">Expand</button>
                                </div>
                            </div>
                            <br/>
                            <div ng-show="expandQry">Query: {{expandQry}}</div>
                            <br/>



                            <uib-tabset ng-show="expandedVS">
                                <uib-tab heading="Concepts">
                                    <div class="myScroll">
                                        <table class="table table-bordered table-condensed">
                                            <tr><th>Display</th><th>Code</th><th>System</th></tr>
                                            <tr ng-repeat="concept in expandedVS.expansion.contains">
                                                <td>{{concept.display}}</td>
                                                <td>
                                                    <div  class="clickable" ng-click="lookup(concept.code,concept.system)">{{concept.code}}</div></td>
                                                <td>{{concept.system}}</td>
                                            </tr>
                                        </table>
                                    </div>


                                </uib-tab>
                                <uib-tab heading="Json">
                                    <pre>{{expandedVS | json}}</pre>
                                </uib-tab>
                            </uib-tabset>






                        </uib-tab>

                        <uib-tab heading="Json">
                            <pre>{{selectedVS | json}}</pre>
                        </uib-tab>

                        <!--

                        <uib-tab>
                            <uib-tab-heading>Unpublished concepts <span class="badge">{{prePubCS.concept.length}}</span>
                            </uib-tab-heading>
                            <br/>
                            <em>This is the custom ValueSet for unpublished concepts. These are concepts that have been defined
                                in SNOMED but not yet published. They have a different system url (as they don't yet exist in the
                                Terminology Server). If they are used by an implementer, then they will be responsible for making
                                any changes required once the concepts are formally published. </em>
                            <uib-tabset>
                                <uib-tab heading="Table">
                                    <br/>
                                    <table class="table table-bordered">
                                        <tr><th>Code</th><th>Display</th></tr>
                                        <tr ng-repeat="concept in prePubCS.concept">
                                            <td>{{concept.code}}</td>
                                            <td>{{concept.display}}</td>

                                        </tr>
                                    </table>

                                </uib-tab>
                                <uib-tab heading="Json">
                                    <pre>{{prePubCS | json}}</pre>

                                </uib-tab>
                            </uib-tabset>




                        </uib-tab>

                        -->

                        <uib-tab heading="History">
                            <button class="btn btn-link pull-right" ng-click="getVersions(selectedVS)">Load versions</button>

                            <div class="clearfix"></div>
                            <br/>

                            <div class="row">
                                <div class="col-md-2">
                                    <div class="myScroll">
                                        <div class="list-group">
                                            <div class="list-group-item"
                                                 style="cursor: pointer"
                                                 ng-click = "selectVersion(entry.resource)"
                                                 ng-repeat = "entry in bundleVersions.entry">
                                                {{entry.resource.meta.lastUpdated | date : "d MMM HH:mm"}}

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-10">
                                    <div ng-show="selectedVersion">

                                        <div>Title: {{selectedVersion.title}}</div>
                                        <div>Description: {{selectedVersion.description}}</div>
                                        <div>Updated: {{selectedVersion.meta.lastUpdated | date : "d MMM HH:mm"}}</div>
                                        <pre>{{selectedVersion.compose | json}}</pre>
                                        <br/>
                                        <button class="btn-link btn pull-right"
                                                ng-click="revert(selectedVersion)">Select for reversion</button>
                                    </div>

                                </div>
                            </div>



                        </uib-tab>

                    </uib-tabset>



                </div>
            </div>


        </uib-tab>



        <uib-tab>
            <uib-tab-heading>Unpublished concepts
                <span ng-if="false" class="badge">{{prePubCS.concept.length}}
                </span>
            </uib-tab-heading>
            <br/>

            <uib-tabset>
                <uib-tab heading="List">
                    <em>This is the custom CodeSystem for unpublished concepts. These are concepts that have been defined
                        in SNOMED-CT but not yet published. They have a different system url (as they don't yet exist in the
                        Terminology Server). If they are used by an implementer, then they will be responsible for making
                        any changes required once the concepts are formally published. </em>
                    <uib-tabset>
                        <uib-tab heading="Table">
                            <br/>
                            <table class="table table-bordered">
                                <tr><th>Code</th><th>Display</th></tr>
                                <tr ng-repeat="concept in prePubCS.concept">
                                    <td>{{concept.code}}</td>
                                    <td>{{concept.display}}</td>

                                </tr>
                            </table>

                        </uib-tab>
                        <uib-tab heading="Json">
                            <pre>{{prePubCS | json}}</pre>

                        </uib-tab>
                    </uib-tabset>

                </uib-tab>
                <uib-tab heading="Audit">
                    <ng-include src="'includes/unpublishedCodes.html'"></ng-include>
                </uib-tab>
            </uib-tabset>





        </uib-tab>



        <uib-tab heading="Create CodeSystem">
            <br/>
            <div ng-controller="customCodeSystemCtrl">
                <ng-include src="'includes/customCodeSystem.html'"></ng-include>
            </div>

        </uib-tab>

        <!--
        <uib-tab heading="ConceptMap">
            <br/>
            <uib-tabset>
                <uib-tab heading="Maps by domain">
                    <ng-include src="'/includes/cmUploader.html'"></ng-include>
                </uib-tab>
                <uib-tab heading="All ConceptMaps">
                    <br/>
                    <uib-tabset>
                        <uib-tab heading="UI ConceptMaps">
                            <em>These are all ConceptMaps that are intended for driving a dynamic UI.
                                Specifically, they do NOT include ConceptMaps that were uploaded using the 'Upload external CM' tab</em>
                            <br/>
                            <table class="table-bordered table">
                                <tr><th>Id</th><th>Description</th><th>Status</th><th>Version</th><th>Last updated</th></tr>
                                <tr ng-repeat="cm in everyConceptMap">
                                    <td>
                                        <div class="clickable" ng-click="viewConceptMap(cm)">{{cm.id}}</div></td>
                                    <td>{{cm.description}}</td>
                                    <td>{{cm.status}}</td>
                                    <td>{{cm.version}}</td>
                                    <td>{{cm.meta.lastUpdated | date : "MMM dd yyyy HH:mm"}}</td>

                                </tr>
                            </table>
                        </uib-tab>
                        <uib-tab heading="External (Analytics) ConceptMaps">
                            <em>These are all ConceptMaps that are intended for analytics - or, at least, not driving a UI.
                                They are the ones that were uploaded using the 'Upload external CM' tab</em>
                            <br/>
                            <table class="table-bordered table">
                                <tr><th>Id</th><th>Description</th><th>Status</th><th>Version</th><th>Last updated</th></tr>
                                <tr ng-repeat="entry in allAnalyticCMBundle.entry">
                                    <td>
                                        <div class="clickable" ng-click="viewConceptMap(entry.resource)">{{entry.resource.id}}</div></td>
                                    <td>{{entry.resource.description}}</td>
                                    <td>{{entry.resource.status}}</td>
                                    <td>{{entry.resource.version}}</td>
                                    <td>{{entry.resource.meta.lastUpdated | date : "MMM dd yyyy HH:mm"}}</td>

                                </tr>
                            </table>






                        </uib-tab>
                    </uib-tabset>



                </uib-tab>


                <uib-tab heading="ConceptMap configuration">
                    <em>This is the configuration used in the Dynamic UI app</em>
                    <uib-tabset>
                        <uib-tab heading="Table">
                            <strong>Diagnostic properties</strong>
                            <table class="table-bordered table">
                                <tr><th>Property</th><th>Code</th><th>UI display</th><th>Next property</th><th>Previous property</th><th>Full VS</th></tr>
                                <tr ng-repeat = "(k,v) in cmConfig.diagnosticProperties">
                                    <td>{{k}}</td>
                                    <td>{{v.concept.code}}</td>
                                    <td>{{v.UI}}</td>

                                    <td>{{v.next}}</td>
                                    <td>{{v.previous}}</td>
                                    <td><div class="clickable" ng-click="viewVS(v.fullVS)">{{v.fullVS}}</div> </td>



                                </tr>
                            </table>

                            <strong>Staging properties</strong>
                            <table class="table-bordered table">
                                <tr><th>Property</th><th>Group</th><th>Code</th><th>UI display</th></tr>
                                <tr ng-repeat = "(k,v) in cmConfig.stagingProperties">
                                    <td>{{k}}</td>
                                    <td>
                                        <div ng-if="v.staging1">Section 1</div>
                                        <div ng-if="v.staging2">Section 2</div>
                                    </td>
                                    <td>{{v.concept.code}}</td>

                                    <td>{{v.UI}}</td>




                                </tr>
                            </table>

                        </uib-tab>
                        <uib-tab heading="Json">
                            <pre>{{cmConfig | json}}</pre>
                        </uib-tab>
                    </uib-tabset>
                </uib-tab>


                <uib-tab heading="Upload External ConceptMap Json">
                    <div ng-controller="uploadCmCtrl">
                        <ng-include src="'/includes/uploadCM.html'"></ng-include>
                    </div>



                </uib-tab>
            </uib-tabset>





        </uib-tab>
        -->

        <uib-tab heading="Batch ValueSet upload">

            <ng-include src="'includes/batchVS.html'"></ng-include>



        </uib-tab>
        <uib-tab  heading="Test ECL">
            <br/>
            <div class="row">
                <div class="col-md-5">
                    <textarea class="form-control" rows=10 ng-model="input.testECL"></textarea>

                </div>
                <div class="col-md-2">
                    <button class="btn btn-link" ng-click="testECL(input.testECL)">Expand</button>

                </div>
                <div class="col-md-5">
                    <table class="table-bordered table">
                        <tr ng-repeat = 'concept in testECLData.expansion.contains'>
                            <td>{{concept.display}}</td>
                            <td>{{concept.code}}</td>
                            <td>{{concept.system}}</td>
                        </tr>
                    </table>


                </div>
            </div>
        </uib-tab>

        <uib-tab heading="Member Count">
            <br/>


            <div class="row">
                <div class="col-md-6">
                    Member count on Production last updated: {{getMemberCountDate() | date}}

                    <button class="btn btn-link"
                            ng-hide = "showGettingMC"
                            ng-click="updateAllMemberCount()">Update member count</button>

                    <button class="btn btn-info pull-right" ng-if = "showGettingMC" style="margin-right: 8px">
                        Updating member count.  {{mcProgress}}
                    </button>


                </div>
                <div class="col-md-6">
                    <a ng-show="downloadLinkCsvName" class="btn btn-link pull-right"  download="{{downloadLinkCsvName}}"
                       href="{{downloadLinkCsv}}" title="{{downloadLinkCsvName}}" >
                        Download VS list
                    </a>
                </div>
            </div>


            <table class="table table-bordered">
                <tr><th>Id</th><th>Title</th><th>Description</th><th>Status</th><th>Count</th></tr>
                <tr
                        ng-class="{retiredVS:item.vs.status == 'retired',draftVS:item.vs.status == 'draft'}"
                        ng-repeat="item in listForMemberCount">
                    <td>{{item.vs.id}}</td>
                    <td>{{item.vs.title}}</td>
                    <td>{{item.vs.description}}</td>
                    <td>{{item.vs.status}}</td>
                    <td>{{getMCOneVS(item.vs.url)}}</td>
                </tr>
            </table>





        </uib-tab>

    </uib-tabset>





</div>
</body>
