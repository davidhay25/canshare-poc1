<div ng-controller="modelDGCtrl">
  <br/>
  <div class="row">
    <div class="col-md-6">
      <strong>{{selectedModel.description}}</strong>
    </div>

    <div class="col-md-3">
      FHIR resource: <a target = "_blank" ng-href="{{fhirRoot}}{{selectedModel.fhirResource}}">{{selectedModel.fhirResource}}</a>
    </div>

    <div class="col-md-3">
      <div class="pull-right">
        <checkbox ng-model="input.showFullModel" ng-click="updateFullModelShow()"></checkbox> Show expanded model
      </div>
    </div>
  </div>
  <br/>


  <uib-tabset>

    <uib-tab heading="Tree">
      <em>The model as a tree. Expanded if the checkbox is selected</em>
      <div class="row">
        <div class="col-md-6">
          <div id="dgTree"></div>
        </div>
        <div class="col-md-6">

          <div ng-show="selectedNode.data.ed">

            <uib-tabset>
              <uib-tab heading="Details">
                <table class="table table-bordered table-condensed">
                  <tr><td style="width : 20%">Path</td><td>{{selectedNode.data.ed.path}}</td></tr>
                  <tr><td>Type</td>
                    <td><div ng-repeat="type in selectedNode.data.ed.type">
                      {{type}}&nbsp;</div>
                    </td></tr>
                  <tr><td>Description</td><td>{{selectedNode.data.ed.description}}</td></tr>
                  <tr ng-show="selectedNode.data.ed.valueSet">
                    <td>ValueSet</td>
                    <td>{{selectedNode.data.ed.valueSet}}</td>
                  </tr>




                </table>

                <div class="row"  ng-show="selectedNode.data.ed.type[0] == 'CodeableConcept'">
                  <div class="col-md-3">
                    ValueSet
                  </div>
                  <div class="col-md-9">
                    <div><em>{{selectedNode.data.ed.valueSet}}</em></div>
                    <div>
                      <span ng-show="selectedNode.data.ed.valueSet" class="clickable">View VS</span>

                      <button ng-show="selectedNode.data.ed.valueSet"
                              ng-click = "changeDGValueSet(selectedNode.data.ed)"
                              class="btn-link btn">Change VS</button>

                      <button ng-hide="selectedNode.data.ed.valueSet"
                              ng-click = "changeDGValueSet(selectedNode.data.ed)"
                              class="btn-link btn">Set VS</button>



                    </div>
                  </div>
                </div>


                <div class="row"  ng-show="selectedNode.data.ed.type[0] == 'CodeableConcept'">
                  <div class="col-md-3">
                    Options List
                  </div>
                  <div class="col-md-9">
                    <div ng-show="selectedNode.data.ed.options">
                      There are {{selectedNode.data.ed.options.length}} options defined
                    </div>

                    <div ng-hide="selectedNode.data.ed.options">
                      There are no options defined
                    </div>
                    <div><em>Options are used to build ValueSets</em></div>


                    <button
                            ng-click = "editDGOptionsList(selectedNode.data.ed)"
                            class="btn-link btn">View / Edit list</button>

                  </div>
                </div>


                <!-- If the ValueSet depends on some other value in the DG-->
                <div ng-show="selectedNode.data.ed.dependVS">
                  ValueSet is dependent on other DG values
                  <br/>
                  <table class="table table-bordered">
                    <tr><th>Source</th><th>Value</th><th>Url</th></tr>
                    <tr ng-repeat="dep in selectedNode.data.ed.dependVS">
                      <td>{{dep.source}}</td>
                      <td>{{dep.value}}</td>
                      <td>{{dep.url}}</td>
                    </tr>
                  </table>

                </div>
              </uib-tab>
              <uib-tab heading="Json">
                <pre ng-show="selectedNode">{{selectedNode.data.ed | json}}</pre>
              </uib-tab>
            </uib-tabset>




          </div>

          <br/>



          <div ng-show="selectedModel.kind == 'comp'">
            <div ng-show="selectedNode.data.ed.type.indexOf('CodeableConcept') > -1" >
              <button class="btn btn-link" ng-click="setValueSet(selectedNode.data.ed)">
                Set ValueSet
              </button>
            </div>

            <div ng-hide="!selectedNode || selectedNode.data.ed.mult.indexOf('0..0') > -1" >
              <button class="btn btn-link" ng-click="removeElement(selectedNode.data.ed)">
                Remove element
              </button>
            </div>

          </div>








        </div>
      </div>



    </uib-tab>


    <uib-tab heading="Table">
      <em class="pull-right">The model as a table. Expanded if the checkbox is selected</em>

      <div ng-show = "selectedModel.parent">
        <strong class="pull-left">Profiles: {{selectedModel.parent}}</strong>
      </div>

      <table class="table-bordered table">
        <tr><th>Path</th><th>Title</th><th>Description</th><th>Type</th><th>Mult.</th><th>Code</th></tr>
        <tr ng-repeat="element in fullElementList" ng-hide="$index==0 || element.mult.indexOf('..0') > -1">

          <td>
            <div  ng-style="{ 'padding-left': (element.path | pathindent) }">
              <!-- {{element.path | dropFirstInPath}} -->
              <div ng-hide="input.showFullModel">
                {{element.path | dropFirstInPath}}
              </div>
              <div ng-show="input.showFullModel">
                {{element.path | lastInPath}}

              </div>



            </div>


          </td>
          <td>{{element.title}}</td>
          <td>{{element.description}}</td>
          <td>
            <div ng-repeat="type in element.type">
              {{type}}
            </div>
            <div><em class="clickable" ng-click="showVS(element.valueSet)">{{element.valueSet}}</em></div>
          </td>
          <td>{{element.mult}}</td>
          <td>
            <div ng-repeat="code in element.code">
              {{code.code}}
            </div>

          </td>

        </tr>
      </table>
    </uib-tab>


    <uib-tab heading="Graph" select="fitGraph()">

      <div class="row">
        <div class="col-md-6">
          <div id="graph"></div>
        </div>
        <div class="col-md-6">
          <uib-tabset ng-show="selectedModelFromGraph">
            <uib-tab heading="Table">

              <div class="row">
                <div class="col-md-2">Name:</div>
                <div class="col-md-10">{{selectedModelFromGraph.name}}</div>
              </div>
              <div class="row">
                <div class="col-md-2">Title:</div>
                <div class="col-md-10">{{selectedModelFromGraph.title}}</div>
              </div>


              <br/>
              <table class="table-bordered table table-condensed">
                <tr><th>Path</th><th>Type</th><th>Card.</th></tr>
                <tr ng-repeat="ed in selectedModelFromGraph.diff">
                  <td>{{ed.path}}
                    <div style="padding-left: 8px"><em >{{ed.description}}</em></div>
                  </td>
                  <td>{{ed.type[0]}}
                    <div class="clickable"><em>{{ed.valueSet}}</em></div>
                  </td>
                  <!--
                  <td>
                      <div ng-repeat="code in code">
                          {{code}}
                      </div>
                  </td>
                  -->
                  <td>{{ed.mult}}</td>
                </tr>
              </table>

            </uib-tab>
            <uib-tab heading="Json">
              <pre>{{selectedModelFromGraph | json}}</pre>
            </uib-tab>
          </uib-tabset>


        </div>
      </div>


    </uib-tab>

    <uib-tab ng-show="selectedModel.kind == 'dg'">
      <uib-tab-heading>Referenced by</uib-tab-heading>


      <table class="table table-bordered">
        <tr><th>Name</th><th>Path</th><th>Kind</th></tr>
        <tr ng-repeat="item in xref[selectedModel.name] track by $index">
          <td>
            <div class="clickable" ng-click="selectModelFromList(item.name,item.kind)">
              {{item.name}}
            </div>


          </td>
          <td>{{item.path}}</td>
          <td>{{item.kind}}</td>
        </tr>
      </table>
      <!--
                                  {{selectedModel.name}}
                                  <pre>{{xref | json}}</pre>

      -->



    </uib-tab>

    <uib-tab heading="Questionnaire">
      <uib-tabset>
        <uib-tab heading="Form">
          <renderform q="Qobject" qr="QR"></renderform>
        </uib-tab>
        <uib-tab heading="Json">
          <pre>{{Qobject | json}}</pre>
        </uib-tab>
      </uib-tabset>





    </uib-tab>


    <uib-tab ng-show="selectedModel.kind == 'comp'" heading="Overrides">
      <em class="pull-right">Elements that have been overriden in this model</em>

      <div ng-show = "selectedModel.parent">
        <strong class="pull-left">Profiles: {{selectedModel.parent}}</strong>
      </div>

      <table class="table-bordered table">
        <tr><th>Path</th><th>Title</th><th>Description</th><th>Type</th><th>Mult.</th><th>Code</th></tr>
        <tr ng-repeat="element in overrides">

          <td>
            <div>
              {{element.path}}


              <!-- {{element.path | dropFirstInPath}} -->
              <!--
              <div ng-hide="input.showFullModel">
                  {{element.path | dropFirstInPath}}
              </div>
              <div ng-show="input.showFullModel">
                  {{element.path | lastInPath}}

              </div>
-->


            </div>


          </td>
          <td>{{element.title}}</td>
          <td>{{element.description}}</td>
          <td>
            <div ng-repeat="type in element.type">
              {{type}}
            </div>
            <div><em class="clickable" ng-click="showVS(element.valueSet)">{{element.valueSet}}</em></div>
          </td>
          <td>{{element.mult}}</td>
          <td>
            <div ng-repeat="code in element.code">
              {{code.code}}
            </div>

          </td>

        </tr>
      </table>
    </uib-tab>




    <uib-tab ng-show="false" heading="Json">
      <em>All the elements in a 'flattened' list (like a StructureDefinition).</em>
      <pre>{{fullElementList | json}}</pre>
    </uib-tab>

    <uib-tab heading="Json">
      <em>The definition for this model (not expanded)</em>
      <pre>{{selectedModel | json}}</pre>
    </uib-tab>


  </uib-tabset>


</div>