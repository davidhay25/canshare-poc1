<div>

  <div class="row" ng-show="selectedComposition">
    <div class="col-md-4">
      <div class="banner">Sections</div>
      <div class="list-group">
        <div ng-class="{'list-group-item':true,listItemSelected:section == selectedSection}"
             style="cursor: pointer"
             ng-click="selectSection(section)"

             ng-repeat="section in selectedComposition.sections">

              <span class="clickable pull-right" ng-click="removeSection($index)">
                <i class="glyphicon glyphicon-remove"></i>
              </span>

              <span ng-hide="$index==0" class="clickable pull-right" ng-click="moveSectionUp($index)">
                    <i class="glyphicon glyphicon-arrow-up"></i>
              </span>

              <span ng-hide="$index == selectedComposition.sections.length-1" class="clickable pull-right" ng-click="moveSectionDown($index)">
                  <i class="glyphicon glyphicon-arrow-down"></i>
              </span>

          {{section.title || section.name}}
        </div>
      </div>

      <h5>New section</h5>


      <div class="row">
        <div class="col-md-10">
          <input type="text" placeholder="Section name"
                 class="form-control" ng-model="local.sectionName"/>
          <div>
            <input type="text" placeholder="Title"
                   class="form-control" ng-model="local.sectionTitle"/>
          </div>
        </div>
        <div class="col-md-2">
          <button ng-show="local.sectionName"
                  class="btn-link btn" ng-click="addSection(local.sectionName,local.sectionTitle)">Add</button>
        </div>
      </div>



    </div>
    <div class="col-md-4" ng-show="selectedSection">
      <div class="banner">DGs in section</div>


      <div class="list-group">
        <div ng-class="{'list-group-item':true,listItemSelected:item == selectedItem}"
             ng-click="selectItem(item)"
             style="cursor: pointer"
             ng-repeat="item in selectedSection.items">

            <i class="glyphicon glyphicon-remove pull-right clickable"
              ng-click="removeDG($index)"></i>

            <span ng-hide="$index==0" class="clickable pull-right" ng-click="moveDGUp($index)">
                    <i class="glyphicon glyphicon-arrow-up"></i>
            </span>

            <span ng-hide="$index==selectedSection.items.length -1" class="clickable pull-right" ng-click="moveDGDown($index)">
                  <i class="glyphicon glyphicon-arrow-down"></i>
            </span>



          {{item.title}}
        </div>
      </div>
      <hr/>

      <div class="row">
        <div class="col-md-10">
          <strong>{{selectedNewDG.name}}</strong>
          <div><em> {{selectedNewDG.description}}</em></div>
        </div>
        <div class="col-md-2">
          <button class="btn btn-link"
                  ng-show="selectedSection && selectedNewDG"
                  ng-click="addSectionItem(selectedNewDG)">Add</button>
        </div>
        <br/>
        <em ng-show="selectedNewDG">Elements:</em>
        <table class="table table-bordered table-condensed">
          <tr ng-repeat="item in fullElementListPossible" ng-hide="item.ed.mult == '0..0'">
            <td>{{item.ed.title || item.ed.path}}</td>
            <td>{{item.ed.description}}</td>
            <td>{{item.ed.mult}}</td>
          </tr>

        </table>

      </div>

    </div>
    <div class="col-md-4" ng-show="selectedSection">
      <div class="banner">Selected DG details, add DG to section</div>
      <uib-tabset>

        <uib-tab heading="Details">

          <div ng-show="selectedItem">
            <button class="btn-link btn pull-right" ng-click="showDG(selectedItem.type[0])">Load {{selectedItem.type[0]}} DataGroup</button>
          </div>

          <table class="table table-bordered table-condensed">
            <tr ng-repeat="item in filteredElementList">
              <td>{{item.ed.title || item.ed.path}}</td>
              <td>{{item.ed.description}}</td>
            </tr>

          </table>

        </uib-tab>


        <uib-tab heading="DG library Tree">
          <!--
          <div class="clickable" ng-click="setup()">refresh</div>
-->
          <div ng-show="selectedNewDG">
            <button class="btn-link btn pull-right" ng-click="showDG(selectedNewDG.name)">Load {{selectedNewDG.name}} DataGroup</button>
            <div class="clearfix"></div>
          </div>

          <div class="myScroll">
            <div id="dgSelectTree"></div>
          </div>




        </uib-tab>

        <uib-tab ng-show="false" heading="DG library List">

         <div class="list-group">
           <div class="list-group-item"
                ng-click = "addSectionItem(v)"
                ng-repeat = "(k,v) in hashAllDG">
             {{k}}
           </div>
         </div>

        </uib-tab>


      </uib-tabset>

    </div>
  </div>


  <div ng-show="selectedSection">
    <h5>Conditionals</h5>

    <strong>Existing conditionals this section</strong>
    <table class="table-bordered table">
      <tr><th>Source Section</th><th>DataGroup</th><th>Element</th><th>Value</th></tr>
      <tr ng-repeat="ew in selectedComposition.enableWhen"
        ng-show="ew.targetSection == selectedSection.name">
        <td>{{ew.sourceSection}}</td>
        <td>{{ew.dg}}</td>
        <td>{{ew.ed}}</td>
        <td>{{ew.value}}</td>
      </tr>
    </table>
    <em>Each row represents a source condition that must be true for the section to appear
    in a Form. There can be multiple - if any match then the section is shown.</em>

    <br/><br/>
    <strong>New conditional</strong>
    <div class="row" >
      <div class="col-md-3">
        Section where the source is

        <select class="form-control" ng-model="local.ewSection" ng-change="getDGsForSection(local.ewSection)"
                ng-options = "section.title for section in local.ewSections"></select>
      </div>

      <div class="col-md-3">
        DG that has the source element
        <select class="form-control" ng-model="local.ewDG" ng-change="getCodedElementsForDG(local.ewDG)"
                ng-options = "dg.title for dg in local.ewDGs"></select>

      </div>

      <div class="col-md-3">
        Coded element in DG
        <select class="form-control" ng-model="local.ewED" ng-change="getValuesForED(local.ewED)"
                ng-options = "element.title for element in local.ewEDs"></select>

      </div>

      <div class="col-md-2">
        Possible values
        <select class="form-control" ng-model="local.ewValue"
                ng-options = "concept.display for concept in local.ewValues"></select>

      </div>

      <div class="col-md-1">
        <br/>
        <i style="color: green" class="glyphicon glyphicon-ok clickable"
           ng-show="local.ewSection && local.ewDG && local.ewED && local.ewValue"
           ng-click="addEW(local.ewSection,local.ewDG,local.ewED,local.ewValue)"></i>
      </div>


    </div>
    <br/>
    <em>Will only allow the source (what has to be true for the section to be shown) to be a coded
    item (ie CodeableConcept) and the source of possible values is currently only from options - not yet the ValueSet.</em>
    <!--
    <pre>{{selectedSection.enableWhen | json}}</pre>
    <pre>{{selectedSection | json}}</pre>
-->

  </div>



</div>